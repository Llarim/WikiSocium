(function(){var a=YAHOO.util.Event,b=YAHOO.util.Dom,c=Y.Lang;inputEx.StringAvailability=function(d){inputEx.StringAvailability.superclass.constructor.call(this,d)};Y.extend(inputEx.StringAvailability,inputEx.StringField,{setOptions:function(d){inputEx.StringAvailability.superclass.setOptions.call(this,d);this.options.uri=d.uri;this.options.messages.stringLoading=(d.messages&&d.messages.stringLoading)?d.messages.stringLoading:inputEx.messages.stringLoading;this.options.messages.stringAvailable=(d.messages&&d.messages.stringAvailable)?d.messages.stringAvailable:inputEx.messages.stringAvailable;this.options.messages.stringUnAvailable=(d.messages&&d.messages.stringUnAvailable)?d.messages.stringUnAvailable:inputEx.messages.stringUnAvailable;this.options.showMsg=false;this.isRequesting=false},renderComponent:function(){inputEx.StringAvailability.superclass.renderComponent.call(this);this.availabilityDiv=inputEx.cn("div",{className:"availabilityDiv"});this.availabilityDivIcon=inputEx.cn("div",{className:"icon"});this.availabilityDivText=inputEx.cn("div",{className:"text"});this.availabilityDiv.appendChild(this.availabilityDivIcon);this.availabilityDiv.appendChild(this.availabilityDivText);this.availabilityDiv.appendChild(inputEx.cn("div",{className:"clear"}))},render:function(){inputEx.StringAvailability.superclass.render.call(this);b.insertAfter(this.availabilityDiv,this.fieldContainer)},onKeyPress:function(d){if(d.keyCode===9){return}this.isRequesting=true;c.later(0,this,function(){if(this.getValue()===""){this.stopTimer();this.setAvailabilityState(this.options.required?"required":"none");return}this.resetTimer();this.setAvailabilityState("loading")})},resetTimer:function(){this.stopTimer();this.startTimer()},startTimer:function(){var d=this;this.timerId=setTimeout(function(){d.getAvailability(d.getValue())},500)},stopTimer:function(){if(this.timerId){clearTimeout(this.timerId);delete this.timerId}},onAvailable:function(){this.setAvailabilityState("available");this.isAvailable=true;this.isRequesting=false},onUnavailable:function(){this.setAvailabilityState("unavailable");this.isAvailable=false;this.isRequesting=false},setAvailabilityState:function(d){if(d==="none"){this.availabilityDivText.innerHTML="";b.setAttribute(this.availabilityDiv,"class","availabilityDiv");this.availabilityDiv.style.display="none";return}else{if(d==="loading"){this.availabilityDivText.innerHTML=this.options.messages.stringLoading}else{if(d==="available"){this.availabilityDivText.innerHTML=this.options.messages.stringAvailable}else{if(d==="unavailable"){this.availabilityDivText.innerHTML=this.options.messages.stringUnAvailable}else{if(d==="required"){this.availabilityDivText.innerHTML=this.options.messages.required}}}}}b.setAttribute(this.availabilityDiv,"class","availabilityDiv "+d);this.availabilityDiv.style.display="block"},setClassFromState:function(){inputEx.StringAvailability.superclass.setClassFromState.call(this);var d=this.getState();if(d==="required"){this.setAvailabilityState(d)}},validate:function(){if(!!this.isRequesting){return false}var d=inputEx.StringAvailability.superclass.validate.call(this);if(!c.isUndefined(this.isAvailable)){d=this.isAvailable&&d}return d},getAvailability:function(d){YAHOO.util.Connect.asyncRequest("GET",this.options.uri+"?availabilityRequest="+d,{success:function(f){var e=c.JSON.parse(f.responseText);if(e==="true"||!!e){this.onAvailable()}else{if(e==="false"||!e){this.onUnavailable()}else{this.failure(f)}}},failure:function(e){this.isRequesting=false},scope:this})}});inputEx.registerType("string-availability",inputEx.StringAvailability)})();