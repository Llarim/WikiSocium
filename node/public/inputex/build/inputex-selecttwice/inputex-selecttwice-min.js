(function(){var a=YAHOO.util.Event,b=Y.Lang;inputEx.SelectTwiceField=function(c){inputEx.SelectTwiceField.superclass.constructor.call(this,c);if(b.isUndefined(this.options.value)){this.setValue(this.getValue(),false)}};Y.extend(inputEx.SelectTwiceField,inputEx.Field,{setOptions:function(c){inputEx.SelectTwiceField.superclass.setOptions.call(this,c);this.options.choices=b.isArray(c.choices)?c.choices:[];this.options.valueSeparator=c.valueSeparator||"_"},renderComponent:function(){var h,f,d,m,g,e,n,k,c,l;this.valuesMatching={};c=function(i,j){i=b.isObject(i)?i.value:i;j=b.isObject(j)?j.value:j;return i===j};l=[];for(h=0,d=this.options.choices.length;h<d;h+=1){n=b.isObject(this.options.choices[h])?this.options.choices[h].value:this.options.choices[h];g=this.options.choices[h].choices;this.valuesMatching[n]=[];if(g){for(f=0,m=g.length;f<m;f+=1){e=g[f];k=b.isObject(e)?e.value:e;this.valuesMatching[n].push(k);if(inputEx.indexOf(k,l,c)===-1){l.push(g[f])}}}}this.selects=[];this.selects.push(new inputEx.SelectField({choices:this.options.choices}));this.selects.push(new inputEx.SelectField({choices:l}));this.fieldContainer.appendChild(this.selects[0].getEl());this.fieldContainer.appendChild(this.selects[1].getEl())},initEvents:function(){inputEx.SelectTwiceField.superclass.initEvents.call(this);this.selects[0].on("updated",function(c){this.updateSecondSelectChoices();this.selects[1].fireUpdatedEvt()},this,true);this.selects[1].on("updated",function(c){this.setClassFromState();this.fireUpdatedEvt()},this,true)},updateSecondSelectChoices:function(){var d,e,f,c,g;c=this.valuesMatching[this.selects[0].getValue()];f=this.selects[1].choicesList;for(d=0,e=f.length;d<e;d+=1){g=f[d].value;if(inputEx.indexOf(g,c)===-1){this.selects[1].hideChoice({position:d},false)}else{this.selects[1].showChoice({position:d})}}},setValue:function(g,e){var d,h,c,f;d=g.split(this.options.valueSeparator);this.selects[0].setValue(d[0],false);this.updateSecondSelectChoices();this.selects[1].setValue(d[1],false);inputEx.SelectTwiceField.superclass.setValue.call(this,g,e)},getValue:function(){return this.selects[0].getValue()+this.options.valueSeparator+this.selects[1].getValue()},getState:function(){if(this.getValue()===this.options.valueSeparator){return this.options.required?inputEx.stateRequired:inputEx.stateEmpty}return this.validate()?inputEx.stateValid:inputEx.stateInvalid}});b.augmentObject(inputEx.SelectTwiceField.prototype,inputEx.mixin.choice);inputEx.registerType("selecttwice",inputEx.SelectTwiceField,[{type:"list",name:"choices",label:"Choices",elementType:{type:"group",fields:[{label:"Value",name:"value",value:""},{label:"Label",name:"label"},{type:"list",name:"choices",label:"Choices",elementType:{type:"group",fields:[{label:"Value",name:"value",value:""},{label:"Label",name:"label"}]},value:[],required:true}]},value:[],required:true}])}());