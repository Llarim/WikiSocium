YUI.add("inputex-map",function(c){var b=c.Lang,a=c.inputEx;a.MapFieldGlobals={yahoo_preloader_error:1,lat:43.648565,lon:-79.385329,uzoom:-13,api:"virtualearth",api_key:""};a.MapFieldZoom={google:{to_universal:function(d){d=parseInt(d);return Math.min(-1,-d)},to_native:function(d){d=parseInt(d);return d>0?d:-d}},virtual_earth:{to_universal:function(d){d=parseInt(d);return Math.min(-1,-d)},to_native:function(d){d=parseInt(d);return d>0?d:-d}},yahoo:{to_universal:function(d){d=parseInt(d);return Math.min(-1,d-18)},to_native:function(d){d=parseInt(d);return d>0?d:Math.max(d+18,1)}}};a.MapField=function(d){a.MapField.superclass.constructor.call(this,d)};c.extend(a.MapField,a.Field,{setOptions:function(d){a.MapField.superclass.setOptions.call(this,d);this.options.className=d.className||"inputEx-Field inputEx-MapField";this.options.width=d.width||"400px";this.options.height=d.height||"400px";this.options.loading=d.loading||"loading....";this.options.lat=d.lat||a.MapFieldGlobals.lat;this.options.lon=d.lon||a.MapFieldGlobals.lon;this.options.uzoom=d.uzoom||a.MapFieldGlobals.uzoom;this.options.api=d.api||a.MapFieldGlobals.api;this.options.api_key=d.api_key||a.MapFieldGlobals.api_key},renderComponent:function(){if(a.MapFieldsNumber==undefined){a.MapFieldsNumber=-1}a.MapFieldsNumber+=1;this.apid=this.virtualearth;if(this.options.api=="virtualearth"){this.apid=this.virtualearth}else{if(this.options.api=="google"){this.apid=this.google}else{if(this.options.api=="yahoo"){this.apid=this.yahoo}else{alert("unknown API '"+this.options.api+"': using 'virtualearth'")}}}var i="inputEx-MapField-"+a.MapFieldsNumber;var h="inputEx-MapFieldWrapper-"+a.MapFieldsNumber;var d="inputEx-MapFieldLat-"+a.MapFieldsNumber;var e="inputEx-MapFieldLon-"+a.MapFieldsNumber;var f="inputEx-MapFieldUZoom-"+a.MapFieldsNumber;var g="inputEx-MapFieldNZoom-"+a.MapFieldsNumber;this.elWrapper=a.cn("div",{id:h,style:"width: "+this.options.width+"; height: "+this.options.height},null,null);this.fieldContainer.appendChild(this.elWrapper);this.el=a.cn("div",{id:i,style:"position: relative; width: "+this.options.width+"; height: "+this.options.height},null,this.options.loading);this.elWrapper.appendChild(this.el);this.elLat=a.cn("input",{id:d,type:"hidden",value:this.options.lat});this.fieldContainer.appendChild(this.elLat);this.elLon=a.cn("input",{id:e,type:"hidden",value:this.options.lon});this.fieldContainer.appendChild(this.elLon);this.elUZoom=a.cn("input",{id:f,type:"hidden",value:this.options.uzoom});this.fieldContainer.appendChild(this.elUZoom);this.elNZoom=a.cn("input",{id:g,type:"hidden",value:this.options.uzoom});this.fieldContainer.appendChild(this.elNZoom);if(this.apid.preload(this)){return}else{this.wait_create()}},setValue:function(e){var d=false;if(e.uzoom!=undefined){this.elUZoom.value=e.uzoom;d=true}else{if(e.nzoom!=undefined){this.elUZoom.value=this.apid.f_zoom.to_universal(e.uzoom);d=true}}if(e.lat!=undefined){this.elLat.value=e.lat;d=true}if(e.lon!=undefined){this.elLon.value=e.lon;d=true}if(d){this.apid.onposition()}},getValue:function(){if(!this.elLat){return{}}return{lat:parseFloat(this.elLat.value),lon:parseFloat(this.elLon.value),uzoom:parseInt(this.elUZoom.value),nzoom:parseInt(this.elNZoom.value)}},wait_create:function(d){if(this==window){d.wait_create(d);return}if(document.getElementById(this.el.id)){this.apid.create(this)}else{window.setTimeout(this.wait_create,0.1,this)}},yahoo:{y_map:null,f_zoom:a.MapFieldZoom.yahoo,preload:function(g){if(window.YMap){return}if(!a.MapFieldGlobals.yahoo_preloader_error){a.MapFieldGlobals.yahoo_preloader_error=1;alert("InputEx.MapField: we do not recommend dynamic API loading for Yahoo Maps")}var d="MapYahooPreloader_"+a.MapFieldsNumber;if(!a[d]){a[d]=1;var f=g.options.api_key[window.location.hostname];if(!f){var f=g.options.api_key}if(!f){alert("No map key is defined for Yahoo Maps");return true}window.YMAPPID=f;var e=document.createElement("script");e.src="http://us.js2.yimg.com/us.js.yimg.com/lib/map/js/api/ymapapi_3_8_0_7.js";e.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(e)}window.setTimeout(function(){if(window.YMap){g.wait_create()}else{g.yahoo.preload(g)}},0.1);return true},create:function(d){this.y_map=new YMap(d.el);this.y_map._mapField=d;this.y_map.addTypeControl();this.y_map.addZoomLong();this.y_map.addPanControl();this.y_map.setMapType(YAHOO_MAP_REG);YEvent.Capture(this.y_map,EventsList.endMapDraw,this.onposition);YEvent.Capture(this.y_map,EventsList.changeZoom,this.onposition);YEvent.Capture(this.y_map,EventsList.endPan,this.onposition);this.y_map.drawZoomAndCenter(new YGeoPoint(d.elLat.value,d.elLon.value),a.MapFieldZoom.yahoo.to_native(d.elUZoom.value))},onposition:function(){try{var f=this.getCenterLatLon();this._mapField.elLat.value=f.Lat;this._mapField.elLon.value=f.Lon;var e=this.getZoomLevel();this._mapField.elNZoom.value=e;this._mapField.elUZoom.value=a.MapFieldZoom.yahoo.to_universal(e)}catch(d){}}},google:{g_map:null,f_zoom:a.MapFieldZoom.google,preload:function(f){if(window.GMap2){return}var d="MapGooglePreloader_"+a.MapFieldsNumber;a[d]=function(){};if(window.google){a[d]()}else{var e=document.createElement("script");e.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=Y.inputEx."+d;e.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(e)}return true},create:function(d){this.g_map=new GMap2(d.el);this.g_map._mapField=d;this.g_geocoder=new GClientGeocoder();this.g_geocoder.setBaseCountryCode("ca");GEvent.addListener(this.g_map,"load",this.onposition);GEvent.addListener(this.g_map,"moveend",this.onposition);GEvent.addListener(this.g_map,"zoomend",this.onposition);this.g_map.addControl(new GSmallMapControl());this.g_map.addControl(new GMapTypeControl());this.g_map.setCenter(new GLatLng(parseFloat(d.elLat.value),parseFloat(d.elLon.value)),a.MapFieldZoom.google.to_native(d.elUZoom.value))},onposition:function(){try{var f=this.getCenter();this._mapField.elLat.value=f.lat();this._mapField.elLon.value=f.lng();var e=this.getZoom();this._mapField.elNZoom.value=e;this._mapField.elUZoom.value=a.MapFieldZoom.google.to_universal(e)}catch(d){}}},virtualearth:{ve_map:null,f_zoom:a.MapFieldZoom.virtualearth,preload:function(f){if(window.VEMap){return}var d="MapVEPreloader_"+a.MapFieldsNumber;a[d]=function(){f.wait_create()};if(!window.attachEvent){var e=document.createElement("script");e.src="http://dev.virtualearth.net/mapcontrol/v6.2/js/atlascompat.js";e.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(e)}var e=document.createElement("script");e.src="http://dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.2&onScriptLoad=inputEx."+d;e.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(e);return true},create:function(f){f.el.style.position="absolute";this.ve_map=new VEMap(f.el.id);this.ve_map._mapField=f;this.ve_map.LoadMap(new VELatLong(f.elLat.value,f.elLon.value),a.MapFieldZoom.virtual_earth.to_native(f.elUZoom.value),VEMapStyle.Road,false,VEMapMode.Mode2D,true,1);var e=this.onposition;var d=this.ve_map;this.ve_map.AttachEvent("onendzoom",function(){e(d)});this.ve_map.AttachEvent("onendpan",function(){e(d)});this.onposition(this.ve_map)},onposition:function(e){if(!e){return}try{var g=e.GetCenter();if(!g||!g.Latitude){return}e._mapField.elLat.value=g.Latitude;e._mapField.elLon.value=g.Longitude;var f=e.GetZoomLevel();e._mapField.elNZoom.value=f;e._mapField.elUZoom.value=a.MapFieldZoom.virtual_earth.to_universal(f)}catch(d){alert("MapField.virtualearth.onposition:"+d)}}},end:0});a.registerType("map",a.MapField);a.MapFieldGlobals.api="yahoo";a.MapFieldGlobals["Nk0DZDzV34FM2CIAsdRAtUgQJRSsJO7x2l5tuDBduamC_gZWkzyTEqcUJxAWjtqxs9Wnxb0-"]="yahoo"},"3.0.0a",{requires:["inputex-field"]});