YUI.add("inputex-dtinplaceedit",function(h){var e=h.inputEx,f=h.YUI2,g=h.Lang,c=f.util.Dom,b=f.util.Event;var a=f.util,d=e.messages;e.widget.dtInPlaceEdit=function(j){e.widget.dtInPlaceEdit.superclass.constructor.call(this,j)};h.extend(e.widget.dtInPlaceEdit,e.widget.DataTable,{renderDatatable:function(){e.widget.dtInPlaceEdit.superclass.renderDatatable.call(this);this.datatable.onEditorBlurEvent=function(j){if(j.editor.save){j.editor.save()}};this.datatable.subscribe("editorSaveEvent",function(k){var j=k.editor.getRecord();if(!g.isUndefined(j.getData("id"))){if(k.newData!==k.oldData){this.onModifyItem(j,k)}}},this,true)},setOptions:function(j){e.widget.dtInPlaceEdit.superclass.setOptions.call(this,j);this.options.allowModify=false;this.options.insertWithDialog=g.isUndefined(j.insertWithDialog)?false:j.insertWithDialog},initEvents:function(){e.widget.dtInPlaceEdit.superclass.initEvents.call(this);this.requiredFieldsEvt=new f.util.CustomEvent("requiredFields",this)},setColumnDefs:function(){var n=e.widget.dtInPlaceEdit.superclass.setColumnDefs.call(this);var j={};for(var m=0;m<this.options.fields.length;m++){j[this.options.fields[m].name]=this.options.fields[m]}for(var o=0;o<n.length;o++){var l=n[o];if(h.Lang.isUndefined(l.editor)&&!!j[l.key]){l.editor=new e.widget.CellEditor(j[l.key])}}return n},_onCellClick:function(m,k){var n=b.getTarget(m);var l=this.datatable.getColumn(n);var o=this.datatable.getTrIndex(n);var j=this.datatable.getRecord(n);if(l.key=="delete"){this.onRemoveItem(j,n)}else{this.onCellClick(m,o)}},onCellClick:function(j,n){var l=j.target,m;l=this.datatable.getTdEl(l);if(l){m=this.datatable.getColumn(l);if(m&&m.editor){var k=this.datatable._oCellEditor;if(k){if(!k._inputExField.validate()){return}}}}this.datatable.onEventShowCellEditor(j)},onRemoveItem:function(j,l){var k=l.childNodes[0];if(!g.isUndefined(j.getData("id"))&&this.deleteLinkNode!=k){if(confirm(e.messages.confirmDeletion)){this.deleteLinkNode=k;this.deleteLinkNode.innerHTML="";c.addClass(this.deleteLinkNode,"inputEx-dtInPlaceEdit-deleteLinkSpinner");this.itemRemovedEvt.fire(j)}}},onRemoveSuccess:function(j){this.datatable.deleteRow(j)},onRemoveFailure:function(){this.deleteLinkNode.innerHTML=e.messages.deleteText;c.removeClass(this.deleteLinkNode,"inputEx-dtInPlaceEdit-deleteLinkSpinner");this.deleteLinkNode=null},onInsertButton:function(l){if(this.options.insertWithDialog){e.widget.dtInPlaceEdit.superclass.onInsertButton.call(this,l);return}var k=this.datatable;k.addRow({});var j=k.getLastTrEl();k.selectRow(j);var m=j.childNodes.length-1;lastCell=j.childNodes[m].childNodes[0];lastCell.innerHTML="";this.addButton=e.cn("input",{type:"button",value:e.messages.addButtonText},null,null);b.addListener(this.addButton,"click",this.onAddButton,this,true);lastCell.appendChild(this.addButton);this.deleteButton=e.cn("input",{type:"button",value:e.messages.cancelText},null,null);b.addListener(this.deleteButton,"click",this.onCancelButton,this,true);lastCell.appendChild(this.deleteButton);this.insertButton.disabled=true},onDialogSave:function(){var j,k;if(!this.dialog.getForm().validate()){return}this.datatable.addRow({});var l=this.datatable.getRecordSet().getLength()-1;this.selectedRecord=l;k=this.dialog.getValue();this.datatable.updateRow(this.selectedRecord,k);j=this.datatable.getRecord(this.selectedRecord);this.itemAddedEvt.fire(j);this.dialog.hide()},onAddButton:function(p){b.stopEvent(p);var o=b.getTarget(p),j=this.datatable.getRecord(o),n,l=[];for(var m=0,k=this.options.fields.length;m<k;m++){n=this.options.fields[m];if(!g.isUndefined(n.required)){if(g.isUndefined(j.getData(n.name))){l.push(n.label)}}}if(l.length>0){this.requiredFieldsEvt.fire(l);return}this.addButton.value=e.messages.loadingText;this.addButton.disabled=true;this.itemAddedEvt.fire(j)},onCancelButton:function(k){b.stopEvent(k);var j=b.getTarget(k);this.datatable.deleteRow(j);this.insertButton.disabled=false},onAddSuccess:function(k,o){if(this.options.insertWithDialog){this.datatable.updateRow(k,o);return}var j=c.get(this.datatable.getLastSelectedRecord()),n=j.childNodes,m=n.length-1,l=n[m].childNodes[0];this.datatable.updateRow(k,o);l.innerHTML=e.messages.deleteText;this.datatable.unselectRow(j);this.insertButton.disabled=false},onAddFailure:function(){if(this.options.insertWithDialog){this.datatable.deleteRow(this.selectedRecord);return}this.addButton.value=e.messages.addButtonText;this.addButton.disabled=false},onModifyItem:function(j,l){var k=l.editor.getTdEl().childNodes[0];c.addClass(k,"inputEx-dtInPlaceEdit-onModifyItem");this.itemModifiedEvt.fire(j)},onModifySuccess:function(j,l){var k=this.datatable.getElementsByClassName("inputEx-dtInPlaceEdit-onModifyItem");for(i=0,nodesLength=k.length;i<nodesLength;i++){c.removeClass(k[i],"inputEx-dtInPlaceEdit-onModifyItem")}if(!g.isUndefined(l)){this.datatable.updateRow(j,l)}}});e.widget.CellEditor=function(j){this._inputExFieldDef=j;this._sId="yui-textboxceditor"+f.widget.BaseCellEditor._nCount;f.widget.BaseCellEditor._nCount++;e.widget.CellEditor.superclass.constructor.call(this,"inputEx",{disableBtns:false})};h.extend(e.widget.CellEditor,f.widget.BaseCellEditor,{renderForm:function(){this._inputExField=e(this._inputExFieldDef);this.getContainerEl().appendChild(this._inputExField.getEl());this.LABEL_SAVE=e.messages.saveText;this.LABEL_CANCEL=e.messages.cancelText},resetForm:function(){this._inputExField.clear();this._inputExField.setValue(this.value)},focus:function(){this._inputExField.focus()},getInputValue:function(){return this._inputExField.getValue()},save:function(){if(this._inputExField.validate()&&this._inputExField.getState()!==e.stateRequired){e.widget.CellEditor.superclass.save.call(this)}},cancel:function(){e.widget.CellEditor.superclass.cancel.call(this)}});h.augment(e.widget.CellEditor,f.widget.BaseCellEditor)},"3.0.0a",{requires:["inputex-datatable"]});